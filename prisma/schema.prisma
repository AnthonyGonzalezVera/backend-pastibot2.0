

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// Usuario de la app (puede ser cuidador o paciente)

model User {
  id         Int        @id @default(autoincrement())
  name       String
  email      String     @unique
  password   String?
  provider   String     @default("email")
  providerId String?    @unique
  verified   Boolean    @default(false)

  role       Role?      // ðŸ‘ˆ AHORA ES OPCIONAL
  gender     String?
  bio        String?    @default("")
  photoUrl   String?    @default("")
  
  patients   Patient[]  @relation("CaregiverPatients")
  createdAt  DateTime   @default(now())
  Medicine   Medicine[]
}



// Paciente vinculado a un cuidador 
model Patient {
  id          Int        @id @default(autoincrement())
  name        String
  email       String     @unique
  gender      String?
  bio         String?    @default("")
  caregiver   User?      @relation("CaregiverPatients", fields: [caregiverId], references: [id])
  caregiverId Int?
  medicines   Medicine[]
}

// Medicamento asociado a un paciente

model Medicine {
  id          Int        @id @default(autoincrement())
  name        String
  dosage      String
  stock       Int? // cÃ¡psulas disponibles (opcional)
  qrData      Json? // metadatos QR (opcional)
  patient     Patient?   @relation(fields: [patientId], references: [id])
  patientId   Int?
  caregiver   User?      @relation(fields: [caregiverId], references: [id])
  caregiverId Int?
  reminders   Reminder[]
  createdAt   DateTime   @default(now())
}

model Reminder {
  id         Int      @id @default(autoincrement())
  time       String // "08:00 AM"
  days       String // "Lu,Ma,Mi,Ju,Vi" o "" si es una sola vez
  label      String? // "DespuÃ©s del almuerzo"
  repeat     Boolean  @default(true)
  active     Boolean  @default(true)
  medicine   Medicine @relation(fields: [medicineId], references: [id])
  medicineId Int
  createdAt  DateTime @default(now())
}

// Estado del robot (baterÃ­a, wifi, etc.)

model RobotState {
  id         Int      @id @default(autoincrement())
  status     String // "OK", "DISPENSANDO", "ERROR"
  wifi       Boolean  @default(false)
  batteryPct Int      @default(0)
  updatedAt  DateTime @default(now())
}

model RobotLog {
  id          Int      @id @default(autoincrement())
  medicineId  Int?
  message     String
  createdAt   DateTime @default(now())
}

enum Role {
  CUIDADOR
  PACIENTE
}
